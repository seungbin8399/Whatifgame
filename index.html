<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ìƒê°ì˜ ë°”ë‹¤ - í† ë¡  ì£¼ì œ ë½‘ê¸°</title>
  <style>
    :root{
      --bg:#f7f8fa; --card:#ffffff; --text:#2c3e50; --muted:#6b7280;
      --primary:#2563eb; --primary-hover:#1e40af; --accent:#10b981; --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{
      margin:0; padding:24px; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg); color:var(--text);
    }
    h1{margin:0 0 12px; font-size:1.8rem}
    .sub{color:var(--muted); margin-bottom:20px}
    .wrap{max-width:980px; margin:0 auto}
    .toolbar,.footer{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center;
      background:var(--card); padding:12px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,.06);
    }
    select,button,input[type="number"],input[type="text"]{
      padding:10px 12px; border:1px solid #e5e7eb; border-radius:10px; background:#fff; color:var(--text);
      font-size:0.95rem;
    }
    button{background:var(--primary); color:#fff; border:none; cursor:pointer}
    button:hover{background:var(--primary-hover)}
    button.ghost{background:#eef2ff; color:#1e3a8a}
    button.gray{background:#e5e7eb; color:#111827}
    button.success{background:var(--accent); color:#fff}
    button.danger{background:var(--danger); color:#fff}
    button.icon{display:flex; align-items:center; gap:6px}
    .grow{flex:1}
    .grid{
      display:grid; grid-template-columns:1fr; gap:16px; margin-top:16px;
    }
    @media(min-width:900px){ .grid{grid-template-columns:2fr 1fr} }
    .card{
      background:var(--card); border-radius:14px; padding:18px; box-shadow:0 6px 16px rgba(0,0,0,.08);
    }
    .question-box{
      min-height:120px; display:flex; align-items:center; justify-content:center;
      font-size:1.4rem; text-align:center; padding:24px; border:2px dashed #e5e7eb; border-radius:12px;
    }
    .meta{display:flex; gap:12px; flex-wrap:wrap; color:var(--muted); margin-top:10px; font-size:.95rem}
    .badge{background:#eef2ff; color:#1e3a8a; padding:4px 8px; border-radius:999px; font-weight:600}
    .count{margin-left:auto}
    .history{max-height:340px; overflow:auto; border-top:1px solid #f3f4f6; margin-top:10px}
    .history-item{display:flex; align-items:center; gap:8px; padding:10px 0; border-bottom:1px dashed #eef2ff}
    .history-item small{color:var(--muted)}
    .history-item .title{flex:1}
    .list{max-height:420px; overflow:auto}
    .list h4{margin:16px 0 8px; color:#111827}
    .list li{margin:6px 0; color:#374151}
    .timer{display:flex; align-items:center; gap:8px; margin-top:10px}
    .timer .display{
      font-variant-numeric: tabular-nums;
      font-size:1.6rem; font-weight:800; padding:8px 12px; background:#0ea5e9; color:#fff; border-radius:10px;
      min-width:120px; text-align:center;
    }
    .status{margin-top:10px; color:var(--muted); min-height:20px}
    .toast{position:fixed; left:50%; transform:translateX(-50%); bottom:24px; background:#111827; color:#fff;
      padding:10px 14px; border-radius:10px; opacity:0; pointer-events:none; transition:opacity .25s}
    .toast.show{opacity:1}
    .muted{color:var(--muted)}
  </style>
</head>
<body>
<div class="wrap">
  <h1>ğŸŒŠ ìƒê°ì˜ ë°”ë‹¤ â€” í† ë¡  ì£¼ì œ ë½‘ê¸°</h1>
  <div class="sub">í† ë¡ ì— ë§ì¶˜ ì£¼ì œ ì¶”ì²¨ê¸°ğŸŒŠ. </div>

  <!-- ìƒë‹¨ íˆ´ë°” -->
  <div class="toolbar" role="region" aria-label="controls">
    <div class="switch" style="display:flex; align-items:center; gap:8px">
      <input type="checkbox" id="roulette" />
      <label for="roulette">ë£°ë › ì• ë‹ˆë©”ì´ì…˜</label>
    </div>
    <select id="category">
      <option value="ALL">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
    </select>
    <button id="btnPick" class="icon"><span>ğŸ²</span><span>ì£¼ì œ ë½‘ê¸°</span></button>
    <button id="btnShowAll" class="ghost">ì „ì²´ ëª©ë¡ í† ê¸€</button>
    <div class="count muted" id="count">0 / 0</div>
  </div>

  <!-- ë³¸ë¬¸ -->
  <div class="grid">
    <section class="card" aria-live="polite">
      <div class="question-box" id="questionBox">ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ì œë¥¼ ë½‘ì•„ë³´ì„¸ìš”!</div>
      <div class="meta">
        <span class="badge" id="currentCategory">ì¹´í…Œê³ ë¦¬: -</span>
        <span class="badge" id="currentRefs">ì—°ê³„ í‚¤ì›Œë“œ: -</span>
        <span class="count" id="subcount"></span>
      </div>

      <!-- íƒ€ì´ë¨¸ -->
      <div class="timer">
        <label for="mins" class="muted">íƒ€ì´ë¨¸:</label>
        <select id="mins">
          <option value="10">10ë¶„</option>
          <option value="12">12ë¶„</option>
          <option value="15" selected>15ë¶„</option>
        </select>
        <button id="btnStartTimer" class="success">ì‹œì‘</button>
        <button id="btnPauseTimer" class="ghost">ì¼ì‹œì •ì§€</button>
        <button id="btnResetTimer" class="danger">ë¦¬ì…‹</button>
        <div class="display" id="timerDisplay">00:00</div>
      </div>

      <div class="status" id="status"></div>

      <div class="footer" style="margin-top:12px">
        <button id="btnCopyCurrent" class="ghost icon"><span>ğŸ“‹</span><span>í˜„ì¬ ì£¼ì œ ë³µì‚¬</span></button>
        <button id="btnCopyHistory" class="ghost icon"><span>ğŸ§¾</span><span>íˆìŠ¤í† ë¦¬ ë³µì‚¬</span></button>
        <div class="grow"></div>
        <button id="btnResetCat" class="gray">í˜„ì¬ ì¹´í…Œê³ ë¦¬ ì´ˆê¸°í™”</button>
        <button id="btnResetAll" class="danger">ì „ì²´ ì´ˆê¸°í™”</button>
      </div>
    </section>

    <aside class="card">
      <div style="display:flex; align-items:center; gap:8px; margin-bottom:6px">
        <strong>ğŸ•˜ íˆìŠ¤í† ë¦¬</strong><span class="muted">(ìµœì‹ ìˆœ)</span>
      </div>
      <div class="history" id="history"></div>
    </aside>
  </div>

  <!-- ì „ì²´ ëª©ë¡ -->
  <section class="card" id="allList" style="margin-top:16px; display:none">
    <h3>ğŸ“‹ ëª¨ë“  ì£¼ì œ (ì¹´í…Œê³ ë¦¬ë³„)</h3>
    <div class="list" id="listContainer"></div>
  </section>
</div>

<div class="toast" id="toast" role="status" aria-live="polite"></div>

<script>
/* =========================
   ë°ì´í„° ì •ì˜
========================= */
const TOPICS = {
  "ì¸ê°„ ì¡´ì¬ì™€ ë³¸ì§ˆ": [
    { q:"ì¸ê°„ì€ ë³¸ì§ˆì ìœ¼ë¡œ ììœ ë¡œìš´ê°€ vs ììœ ëŠ” í™˜ìƒì¼ ë¿ì¸ê°€", refs:"ì‚¬ë¥´íŠ¸ë¥´ Â· ìŠ¤í”¼ë…¸ì" },
    { q:"ìì•„ëŠ” ì‹¤ì¬í•˜ëŠ”ê°€ vs í™˜ìƒì— ë¶ˆê³¼í•œê°€", refs:"ë¶ˆêµ ë¬´ì•„ Â· í˜„ëŒ€ ë‡Œê³¼í•™" },
    { q:"ì¸ê°„ì˜ ì˜ì‹ì€ ë‡Œì˜ ì‚°ë¬¼ì¸ê°€ vs ì´ˆì›”ì ì¸ ë¬´ì–¸ê°€ê°€ ì¡´ì¬í•˜ëŠ”ê°€", refs:"ì˜ì‹ì² í•™ Â· ì‹¬ì‹ ë¬¸ì œ" },
  ],
  "ë„ë•ê³¼ ìœ¤ë¦¬": [
    { q:"ë„ë•ì€ ë³´í¸ì ì¸ê°€ vs ìƒëŒ€ì ì¸ê°€", refs:"ì¹¸íŠ¸ Â· ë¬¸í™”ìƒëŒ€ì£¼ì˜" },
    { q:"ì•…í•œ í–‰ìœ„ìëŠ” ë³¸ì§ˆì ìœ¼ë¡œ ì•…í•œê°€ vs ë‹¨ì§€ ë¬´ì§€í•œê°€", refs:"í”Œë¼í†¤ Â· ì•„ë¦¬ìŠ¤í† í…”ë ˆìŠ¤" },
    { q:"ì´íƒ€ì  í–‰ìœ„ëŠ” ì§„ì •í•œ ì´íƒ€ì¸ê°€ vs ê²°êµ­ ì´ê¸°ì  ë™ê¸°ì¸ê°€", refs:"ì§„í™”ì‹¬ë¦¬í•™ Â· ìœ¤ë¦¬í•™" },
    { q:"ìµœëŒ€ë‹¤ìˆ˜ì˜ ìµœëŒ€í–‰ë³µì´ ì •ì˜ì¸ê°€ vs ê°œì¸ì˜ ê¶Œë¦¬ê°€ ë” ìš°ì„ ì¸ê°€", refs:"ê³µë¦¬ì£¼ì˜ Â· ì¹¸íŠ¸ì£¼ì˜" },
  ],
  "ì‚¬íšŒì™€ ê¶Œë ¥": [
    { q:"êµ­ê°€ëŠ” ì¸ê°„ì˜ ììœ ë¥¼ ë³´ì¥í•˜ëŠ”ê°€ vs ì–µì••í•˜ëŠ”ê°€", refs:"í™‰ìŠ¤ Â· ë£¨ì†Œ Â· í‘¸ì½”" },
    { q:"ì—­ì‚¬ëŠ” ì§„ë³´í•˜ëŠ”ê°€ vs ë°˜ë³µë˜ëŠ”ê°€", refs:"í—¤ê²” Â· ë§ˆë¥´í¬ìŠ¤ Â· ë‹ˆì²´(ì˜ì›íšŒê·€)" },
    { q:"ì–¸ë¡ ì˜ ììœ ëŠ” ì ˆëŒ€ì ì¸ê°€ vs ì œí•œë  ìˆ˜ ìˆëŠ”ê°€", refs:"í‘œí˜„ì˜ ììœ  Â· í•´ì•…ì›ë¦¬" },
    { q:"AIì™€ ê°™ì€ ì´ˆì§€ëŠ¥ì€ ì¸ë¥˜ì˜ ì£¼ì¸ì´ ë  ê²ƒì¸ê°€ vs ë„êµ¬ë¡œ ë‚¨ì„ ê²ƒì¸ê°€", refs:"AI ê±°ë²„ë„ŒìŠ¤ Â· í†µì œë¬¸ì œ" },
  ],
  "ì‚¶ê³¼ ì˜ë¯¸": [
    { q:"ì‚¶ì€ ë³¸ë˜ ì˜ë¯¸ê°€ ìˆëŠ”ê°€ vs ì˜ë¯¸ëŠ” ì¸ê°„ì´ ë¶€ì—¬í•˜ëŠ” ê²ƒì¸ê°€", refs:"ì‹¤ì¡´ì£¼ì˜ Â· í—ˆë¬´ì£¼ì˜" },
    { q:"ì£½ìŒì€ ì‚¶ì„ ì™„ì„±í•˜ëŠ”ê°€ vs ì‚¶ì„ ë¬´ì˜ë¯¸í•˜ê²Œ ë§Œë“œëŠ”ê°€", refs:"í•˜ì´ë°ê±° Â· í…ŒëŸ¬ ë§¤ë‹ˆì§€ë¨¼íŠ¸" },
    { q:"ê³ í†µì€ ì„±ì¥ì˜ í•„ìˆ˜ ì¡°ê±´ì¸ê°€ vs ë‹¨ìˆœí•œ ë¶ˆí–‰ì¼ ë¿ì¸ê°€", refs:"ìŠ¤í† ì•„ Â· ì‹¬ë¦¬í•™" },
    { q:"ì‚¬ë‘ì€ ììœ ë¥¼ ì£¼ëŠ”ê°€ vs êµ¬ì†í•˜ëŠ”ê°€", refs:"ì‚¬ë‘ì² í•™ Â· ê´€ê³„ìœ¤ë¦¬" },
  ],
};

// ì „ì—­ ìƒíƒœ
const STORAGE_KEY = "seangbal_topics_v1";
let used = new Set();         // "ì¹´í…Œê³ ë¦¬|ë¬¸ì¥"
let history = [];             // [{cat, q, refs, ts}]
let current = null;           // {cat,q,refs}
let rouletteOn = false;

// ìš”ì†Œ
const elCategory = document.querySelector("#category");
const elQuestion = document.querySelector("#questionBox");
const elCount = document.querySelector("#count");
const elSubCount = document.querySelector("#subcount");
const elCurrentCat = document.querySelector("#currentCategory");
const elCurrentRefs = document.querySelector("#currentRefs");
const elHistory = document.querySelector("#history");
const elAllList = document.querySelector("#allList");
const elListContainer = document.querySelector("#listContainer");
const elStatus = document.querySelector("#status");
const elToast = document.querySelector("#toast");

// ë²„íŠ¼/ì…ë ¥
const btnPick = document.querySelector("#btnPick");
const btnShowAll = document.querySelector("#btnShowAll");
const btnCopyCurrent = document.querySelector("#btnCopyCurrent");
const btnCopyHistory = document.querySelector("#btnCopyHistory");
const btnResetCat = document.querySelector("#btnResetCat");
const btnResetAll = document.querySelector("#btnResetAll");
const cbRoulette = document.querySelector("#roulette");

// íƒ€ì´ë¨¸
const selMins = document.querySelector("#mins");
const btnStartTimer = document.querySelector("#btnStartTimer");
const btnPauseTimer = document.querySelector("#btnPauseTimer");
const btnResetTimer = document.querySelector("#btnResetTimer");
const displayTimer = document.querySelector("#timerDisplay");
let timerId = null, remainSec = 0, paused = false;

/* =========================
   ì´ˆê¸°í™” & ìƒíƒœ ë³µì›
========================= */
init();

function init(){
  // ì¹´í…Œê³ ë¦¬ ì˜µì…˜
  for(const cat of Object.keys(TOPICS)){
    const opt = document.createElement("option");
    opt.value = cat; opt.textContent = cat;
    elCategory.appendChild(opt);
  }
  // ìŠ¤í† ë¦¬ì§€ ë³µì›
  const saved = loadState();
  if(saved){
    used = new Set(saved.used ?? []);
    history = saved.history ?? [];
  }
  // ì¹´ìš´íŠ¸/ë¦¬ìŠ¤íŠ¸ ë Œë”
  updateCounts();
  renderHistory();
  renderAllList();
  // ìƒíƒœ ë©”ì‹œì§€
  setStatus("ì¤€ë¹„ ì™„ë£Œ. ì£¼ì œë¥¼ ë½‘ì•„ë³´ì„¸ìš”!");
  // ë°ì´í„° ìê°€ ê²€ì¦
  selfValidateData();
}

/* =========================
   ìŠ¤í† ë¦¬ì§€
========================= */
function saveState(){
  const payload = { used: [...used], history };
  localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
}
function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? JSON.parse(raw) : null;
  }catch(e){ console.warn("loadState fail:", e); return null; }
}

/* =========================
   ìœ í‹¸
========================= */
function toast(msg){
  elToast.textContent = msg;
  elToast.classList.add("show");
  setTimeout(()=>elToast.classList.remove("show"), 1400);
}
function setStatus(msg){ elStatus.textContent = msg || ""; }
function nowStr(){
  const d = new Date();
  const pad = n => String(n).padStart(2,"0");
  return `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
}
function totalCount(){
  return Object.values(TOPICS).reduce((a,arr)=>a+arr.length,0);
}
function usedCount(){ return used.size; }
function subCount(cat){
  if(cat==="ALL") return { used:usedCount(), total: totalCount() };
  const total = TOPICS[cat].length;
  const usedInCat = [...used].filter(k => k.startsWith(cat+"|")).length;
  return { used: usedInCat, total };
}
function keyOf(cat, q){ return `${cat}|${q}`; }

/* =========================
   ë Œë”ë§
========================= */
function updateCounts(){
  elCount.textContent = `${usedCount()} / ${totalCount()}`;
  const cat = elCategory.value || "ALL";
  const sc = subCount(cat);
  elSubCount.textContent = `ì´ ì¹´í…Œê³ ë¦¬ ì§„í–‰: ${sc.used} / ${sc.total}`;
}
function renderHistory(){
  elHistory.innerHTML = "";
  if(history.length===0){
    const p = document.createElement("p");
    p.className="muted"; p.textContent="ì•„ì§ ë½‘íŒ ì£¼ì œê°€ ì—†ìŠµë‹ˆë‹¤.";
    elHistory.appendChild(p); return;
  }
  for(const item of [...history].reverse()){
    const row = document.createElement("div");
    row.className = "history-item";
    const t = document.createElement("div");
    t.className="title";
    t.innerHTML = `<strong>${item.q}</strong><br><small>${item.cat} Â· ${item.refs || "-"}</small>`;
    const time = document.createElement("small");
    time.textContent = item.ts;
    const btn = document.createElement("button");
    btn.className="ghost"; btn.textContent="ë³µì‚¬";
    btn.onclick = ()=>copyText(`${item.q} (${item.cat}${item.refs? " Â· "+item.refs:""})`);
    row.appendChild(t); row.appendChild(time); row.appendChild(btn);
    elHistory.appendChild(row);
  }
}
function renderAllList(){
  elListContainer.innerHTML = "";
  for(const [cat, arr] of Object.entries(TOPICS)){
    const h = document.createElement("h4"); h.textContent = cat;
    const ul = document.createElement("ul");
    for(const it of arr){
      const li = document.createElement("li");
      const usedMark = used.has(keyOf(cat,it.q)) ? " Â· ì‚¬ìš©ë¨" : "";
      li.textContent = `${it.q}${usedMark}`;
      ul.appendChild(li);
    }
    elListContainer.appendChild(h);
    elListContainer.appendChild(ul);
  }
}
function updateCurrentUI(item){
  if(!item){
    elQuestion.textContent = "ë²„íŠ¼ì„ ëˆŒëŸ¬ ì£¼ì œë¥¼ ë½‘ì•„ë³´ì„¸ìš”!";
    elCurrentCat.textContent = "ì¹´í…Œê³ ë¦¬: -";
    elCurrentRefs.textContent = "ì—°ê³„ í‚¤ì›Œë“œ: -";
    return;
  }
  elQuestion.textContent = item.q;
  elCurrentCat.textContent = `ì¹´í…Œê³ ë¦¬: ${item.cat}`;
  elCurrentRefs.textContent = `ì—°ê³„ í‚¤ì›Œë“œ: ${item.refs || "-"}`;
}

/* =========================
   ì¶”ì²¨
========================= */
function availablePool(cat){
  const pool = [];
  const cats = cat==="ALL" ? Object.keys(TOPICS) : [cat];
  for(const c of cats){
    for(const it of TOPICS[c]){
      if(!used.has(keyOf(c, it.q))) pool.push({cat:c, q:it.q, refs:it.refs});
    }
  }
  return pool;
}
function pickRandom(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

async function pickTopic(){
  const cat = elCategory.value;
  let pool = availablePool(cat);
  if(pool.length===0){
    if(cat!=="ALL"){
      pool = availablePool("ALL");
      if(pool.length===0){
        setStatus("ëª¨ë“  ì£¼ì œë¥¼ ì†Œì§„í–ˆìŠµë‹ˆë‹¤. ì´ˆê¸°í™”ê°€ í•„ìš”í•´ìš”.");
        toast("ëª¨ë“  ì£¼ì œë¥¼ ë‹¤ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.");
        return;
      }else{
        toast("ì„ íƒí•œ ì¹´í…Œê³ ë¦¬ ì†Œì§„ â†’ ì „ì²´ì—ì„œ ì¶”ì²¨í•©ë‹ˆë‹¤.");
      }
    }else{
      setStatus("ëª¨ë“  ì£¼ì œë¥¼ ì†Œì§„í–ˆìŠµë‹ˆë‹¤. ì´ˆê¸°í™”ê°€ í•„ìš”í•´ìš”.");
      toast("ëª¨ë“  ì£¼ì œë¥¼ ë‹¤ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.");
      return;
    }
  }

  if(rouletteOn){
    await rouletteAnimation(pool.map(p=>p.q));
  }
  const item = pickRandom(pool);
  current = item;

  used.add(keyOf(item.cat, item.q));
  history.push({ ...item, ts: nowStr() });
  saveState();

  updateCounts();
  updateCurrentUI(item);
  renderHistory();
  renderAllList();
  setStatus("ì¶”ì²¨ ì™„ë£Œ! ë°˜ì˜í† ë¡ ì— ë§ê²Œ ì§„í–‰í•˜ì„¸ìš”.");
}
function rouletteAnimation(strings){
  return new Promise(resolve=>{
    const span = 700; // ms
    const start = performance.now();
    const tick = now=>{
      const t = now - start;
      const idx = Math.floor(Math.random()*strings.length);
      elQuestion.textContent = strings[idx];
      if(t < span) requestAnimationFrame(tick);
      else resolve();
    };
    requestAnimationFrame(tick);
  });
}

/* =========================
   íƒ€ì´ë¨¸ (Web Audio ì•Œë¦¼)
========================= */
function startTimer(){
  const mins = parseInt(selMins.value, 10) || 10;
  remainSec = mins*60; paused = false;
  if(timerId) clearInterval(timerId);
  timerId = setInterval(tick,1000);
  renderTimer();
}
function pauseTimer(){
  if(!timerId) return;
  paused = !paused;
  btnPauseTimer.textContent = paused ? "ì¬ê°œ" : "ì¼ì‹œì •ì§€";
}
function resetTimer(){
  clearInterval(timerId); timerId=null; paused=false; remainSec=0;
  renderTimer();
}
function tick(){
  if(paused) return;
  remainSec--;
  if(remainSec<=0){
    clearInterval(timerId); timerId=null; remainSec=0;
    renderTimer(); chime(); toast("â° íƒ€ì„ì—…! ì •ë¦¬ë¡œ ë„˜ì–´ê°€ìš”.");
    return;
  }
  renderTimer();
}
function renderTimer(){
  const m = Math.floor(remainSec/60), s = remainSec%60;
  displayTimer.textContent = `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
}
function chime(){
  try{
    const ctx = new (window.AudioContext||window.webkitAudioContext)();
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.connect(g); g.connect(ctx.destination);
    o.type="sine"; o.frequency.setValueAtTime(880, ctx.currentTime);
    g.gain.setValueAtTime(0.001, ctx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.3, ctx.currentTime+0.01);
    o.start();
    setTimeout(()=>{ g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+0.3); o.stop(ctx.currentTime+0.35); }, 300);
  }catch(e){}
}

/* =========================
   ë³µì‚¬ / ì´ˆê¸°í™”
========================= */
function copyText(text){
  navigator.clipboard.writeText(text).then(()=>toast("ë³µì‚¬ ì™„ë£Œ!"));
}
function copyCurrent(){
  if(!current){ toast("í˜„ì¬ ì£¼ì œê°€ ì—†ìŠµë‹ˆë‹¤."); return; }
  copyText(`${current.q} (${current.cat}${current.refs? " Â· "+current.refs:""})`);
}
function copyHistory(){
  if(history.length===0){ toast("íˆìŠ¤í† ë¦¬ê°€ ë¹„ì–´ìˆì–´ìš”."); return; }
  const lines = history.map(h=>`${h.ts} - ${h.q} (${h.cat}${h.refs? " Â· "+h.refs:""})`);
  copyText(lines.join("\n"));
}
function resetCategory(){
  const cat = elCategory.value;
  if(cat==="ALL"){ toast("ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•œ ë’¤ ì‹¤í–‰í•˜ì„¸ìš”."); return; }
  let cnt=0;
  for(const k of [...used]){
    if(k.startsWith(cat+"|")){ used.delete(k); cnt++; }
  }
  saveState();
  updateCounts(); renderAllList();
  toast(`${cat} ì´ˆê¸°í™”: ${cnt}ê°œ í•´ì œ`);
}
function resetAll(){
  used = new Set(); history = []; current=null;
  saveState();
  updateCounts(); renderHistory(); renderAllList(); updateCurrentUI(null);
  toast("ì „ì²´ ì´ˆê¸°í™” ì™„ë£Œ");
}

/* =========================
   ì „ì²´ ëª©ë¡ í† ê¸€
========================= */
function toggleAllList(){
  const show = elAllList.style.display==="none";
  elAllList.style.display = show ? "block":"none";
  btnShowAll.textContent = show ? "ì „ì²´ ëª©ë¡ ìˆ¨ê¸°ê¸°":"ì „ì²´ ëª©ë¡ í† ê¸€";
}

/* =========================
   ìê°€ ê²€ì¦ (ì¤‘ë³µ/ëˆ„ë½)
========================= */
function selfValidateData(){
  const seen = new Set();
  let dup = [];
  for(const [cat, arr] of Object.entries(TOPICS)){
    for(const it of arr){
      const k = keyOf(cat,it.q);
      if(seen.has(k)) dup.push(k);
      seen.add(k);
    }
  }
  const total = totalCount();
  console.group("%cë°ì´í„° ê²€ì¦","color:#16a34a;font-weight:700");
  console.log("ì´ ì£¼ì œ ìˆ˜:", total);
  if(dup.length){ console.warn("ì¤‘ë³µ ê°ì§€:", dup); } else { console.log("ì¤‘ë³µ ì—†ìŒ âœ…"); }
  const invalidUsed = [...used].filter(k => !seen.has(k));
  if(invalidUsed.length){
    console.warn("ì •ì˜ì— ì—†ëŠ” used í‚¤:", invalidUsed, "â†’ ìë™ ì œê±°");
    for(const k of invalidUsed) used.delete(k);
    saveState();
  } else { console.log("used ì •í•©ì„± OK âœ…"); }
  console.groupEnd();
}

/* =========================
   ì´ë²¤íŠ¸ ë°”ì¸ë”©
========================= */
btnPick.addEventListener("click", pickTopic);
btnShowAll.addEventListener("click", toggleAllList);
btnCopyCurrent.addEventListener("click", copyCurrent);
btnCopyHistory.addEventListener("click", copyHistory);
btnResetCat.addEventListener("click", resetCategory);
btnResetAll.addEventListener("click", resetAll);
cbRoulette.addEventListener("change", e=>{ rouletteOn = e.target.checked; });
elCategory.addEventListener("change", ()=>{ updateCounts(); setStatus("ì¹´í…Œê³ ë¦¬ ë³€ê²½ë¨."); });

btnStartTimer.addEventListener("click", startTimer);
btnPauseTimer.addEventListener("click", pauseTimer);
btnResetTimer.addEventListener("click", resetTimer);

// ì ‘ê·¼ì„±: Enterë¡œ ë¹ ë¥¸ ì¶”ì²¨
document.addEventListener("keydown", e=>{
  if(e.key==="Enter") pickTopic();
});
</script>
</body>
</html>
