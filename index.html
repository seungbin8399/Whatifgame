<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>생각의 바다 — 간단 진행툴</title>
  <style>
    :root{--bg:#0b1020;--card:#121a2f;--text:#eaf0ff;--border:rgba(255,255,255,.08);--muted:#a9b8ff;--chip:#0e1530;--accent:#5eead4}
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Apple SD Gothic Neo","Malgun Gothic",sans-serif;background:var(--bg);color:var(--text);position:relative;overflow-x:hidden}
    #bg{position:fixed;inset:0;z-index:-1}
    .wrap{max-width:900px;margin:0 auto;padding:18px}
    h1{font-size:clamp(22px,3.2vw,32px);margin:0 0 8px}
    h2{margin:0 0 6px}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;margin:10px 0;backdrop-filter:saturate(120%) blur(2px)}
    button{background:#2a3a6a;color:var(--text);border:1px solid var(--border);padding:9px 12px;border-radius:10px;cursor:pointer}
    button.ghost{background:transparent}
    button.accent{background:#145a56}
    textarea, input{width:100%;background:#0f1630;color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px}
    .muted{color:var(--muted);font-size:13px}
    ul{margin:8px 0 0 18px}
    .grid{display:grid;gap:10px}
    .two{grid-template-columns:1fr 1fr}
    @media (max-width:780px){.two{grid-template-columns:1fr}}
    .list{display:flex;flex-wrap:wrap;gap:6px}
    .chip{border:1px solid var(--border);padding:5px 8px;border-radius:999px;background:var(--chip)}
    .mono{font-family:ui-monospace,Menlo,monospace}
    #exportPreview{display:none}
  </style>
</head>
<body>
  <canvas id="bg"></canvas>
  <div class="wrap">
    <h1>🌊 생각의 바다 — 간단 진행툴</h1>
    <p class="muted">밸런스게임 뽑기 · 키워드 뽑기 · 조 섞기(6인×2, 4인×2). 로컬에서만 동작, 설치/로그인 없음.</p>

    <!-- 밸런스게임 -->
    <section class="card">
      <h2>1) 밸런스게임 주제 뽑기</h2>
      <div class="row">
        <button id="pickBG">무작위 1개 뽑기</button>
        <button id="pickBG3" class="ghost">무작위 3개</button>
        <button id="copyBG" class="ghost">복사</button>
      </div>
      <div id="bgResult" class="list" style="margin-top:8px"></div>
      <details style="margin-top:10px">
        <summary class="muted">기본 질문 보기 / 수정</summary>
        <ul id="bgPreview"></ul>
      </details>
    </section>

    <!-- 키워드 토론 -->
    <section class="card">
      <h2>2) 키워드 토론 주제 뽑기</h2>
      <div class="row">
        <button id="pickKW2">무작위 2개</button>
        <button id="pickKW1" class="ghost">무작위 1개</button>
        <button id="copyKW" class="ghost">복사</button>
      </div>
      <div id="kwResult" class="list" style="margin-top:8px"></div>
      <details style="margin-top:10px">
        <summary class="muted">기본 키워드/질문 보기</summary>
        <ul id="kwPreview"></ul>
      </details>
    </section>

    <!-- 조 섞기 -->
    <section class="card">
      <h2>3) 조 섞기 (6인×2, 4인×2)</h2>
      <div class="grid two">
        <div>
          <label class="muted">참여자 (줄바꿈으로 구분)</label>
          <textarea id="names" rows="8"></textarea>
          <div class="row" style="margin-top:8px">
            <button id="shuffle">섞어서 배정 (6×2, 4×2)</button>
            <button id="copyTeams" class="ghost">결과 복사</button>
            <button id="saveImage" class="accent">이미지로 저장</button>
          </div>
          <p class="muted">※ 총 필요 인원 20명 (6·6·4·4). 남는 인원은 <em>예비/스탠바이</em>로 표시됩니다.</p>
        </div>
        <div>
          <div id="teams"></div>
        </div>
      </div>
      <canvas id="exportPreview" width="1200" height="800"></canvas>
    </section>

    <p class="muted">© 생각의 바다 — 심플 버전</p>
  </div>

  <script>
    // ===== BG FLOATING CANVAS =====
    (function(){
      const c=document.getElementById('bg');
      const ctx=c.getContext('2d');
      const DPR= Math.max(1, window.devicePixelRatio||1);
      let W,H,particles=[];
      function resize(){
        W = c.width = Math.floor(innerWidth*DPR);
        H = c.height= Math.floor(innerHeight*DPR);
        c.style.width = innerWidth+'px';
        c.style.height= innerHeight+'px';
        spawn();
      }
      function spawn(){
        const count = Math.min(120, Math.floor((innerWidth*innerHeight)/12000));
        particles = Array.from({length:count}).map(()=>({
          x: Math.random()*W,
          y: Math.random()*H,
          r: (Math.random()*2+0.6)*DPR,
          a: Math.random()*Math.PI*2,
          s: Math.random()*0.5+0.2,
          hue: 210 + Math.random()*40
        }));
      }
      function step(){
        ctx.clearRect(0,0,W,H);
        for(const p of particles){
          p.a += 0.003 + p.s*0.002;
          p.y -= (0.2 + p.s)*DPR;
          p.x += Math.cos(p.a)*0.6*DPR;
          if(p.y < -10*DPR){ p.y = H+10*DPR; p.x = Math.random()*W; }
          ctx.beginPath();
          ctx.fillStyle = `hsla(${p.hue},70%,70%,0.08)`;
          ctx.arc(p.x,p.y,p.r*6,0,Math.PI*2);
          ctx.fill();
          ctx.beginPath();
          ctx.fillStyle = `hsla(${p.hue},80%,75%,0.25)`;
          ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
          ctx.fill();
        }
        requestAnimationFrame(step);
      }
      addEventListener('resize', resize);
      resize();
      step();
    })();

    // ===== 데이터 =====
    const BG = [
      ["힘들어도 “괜찮아” 하며 버티는 삶" , "힘들면 솔직하게 “못 하겠다” 말하는 삶"],
      ["진짜 나를 보여주고 외면당하기","가짜 나를 보여주고 인정받기"],
      ["내가 사랑하는 사람과만 남는 세상","나를 사랑하는 사람과만 남는 세상"],
      ["모든 사람에게 호감형","단 한 사람에게만 진심으로 사랑받음"],
      ["여름에만 살기","겨울에만 살기"],
      ["내가 사랑하는 사람이 먼저 세상을 떠나는 것","내가 먼저 세상을 떠나는 것"],
      ["행복은 선택할 수 있는 것","행복은 우연히 찾아오는 것"],
      ["과거로 시간여행","미래로 시간여행"],
      ["사랑 없는 결혼","돈 없는 결혼"],
      ["평생 택시 무료","평생 비행기 무료"],
      ["종강 늦게하는 수업","과제 많고 팀플 많은 수업"],
      ["팀플 무임승차 팀원 만나기","팀플 리더 맡아서 다 떠안기"],
      ["한국 사회의 기대에 맞춰 살기","내 가치관대로 살지만 비난받기"],
      ["사소한 맞춤법도 틀리는 애인","사소한 맞춤법도 지적하는 애인"],
      ["공공장소에서도 스킨십하는 애인","손 닿으면 펄쩍 뛰어 도망가는 애인"]
    ];

    const KW = [
      {name:'행복', qs:['행복은 돈으로 살 수 있나요?','가장 최근의 소소한 행복은?']},
      {name:'돈', qs:['돈은 자유를 주나요, 구속하나요?','얼마가 있으면 “충분”한가요?']},
      {name:'자유', qs:['자유는 무엇의 부재인가요?','자유와 책임의 균형은?']},
      {name:'관계', qs:['관계가 나를 구속한다고 느낄 때는?','좋은 관계의 최소조건은?']},
      {name:'죽음', qs:['죽음 인식이 삶을 어떻게 바꾸나요?','임종 때 가장 후회할 일은?']},
      {name:'사랑', qs:['사랑은 감정인가요, 선택인가요?','사랑은 평생 지속될 수 있을까요?']},
      {name:'정체성', qs:['나는 “나다움”을 어떻게 정의하나요?','정체성은 고정된 것일까요, 변화하는 것일까요?']},
      {name:'기억', qs:['기억이 곧 나인가요?','행복했던 순간과 힘들었던 순간, 무엇이 더 나를 형성하나요?']}
    ];

    // ===== 유틸 =====
    const $ = (sel, root=document) => root.querySelector(sel);
    function shuffleArray(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    }
    function copyText(t){
      const txt = (t||'').trim();
      if(!txt){ alert('복사할 내용이 없습니다.'); return; }
      navigator.clipboard.writeText(txt).then(()=> alert('복사 완료!'));
    }

    // ===== 밸런스게임 =====
    function renderBGPreview(){
      const ul = $('#bgPreview'); if(!ul) return; ul.innerHTML='';
      BG.forEach((q,i)=>{
        const li=document.createElement('li');
        li.textContent = `Q${i+1}. ${q[0]}  vs  ${q[1]}`;
        ul.appendChild(li);
      });
    }
    function pickBG(n=1){
      const picks = shuffleArray(BG).slice(0,n);
      const holder = $('#bgResult'); if(holder){ holder.innerHTML='';
        picks.forEach(([a,b],i)=>{
          const div=document.createElement('div'); div.className='chip';
          div.textContent = `Q${i+1}: ${a}  vs  ${b}`;
          holder.appendChild(div);
        });
      }
      return picks.map(([a,b],i)=>`Q${i+1}: ${a} vs ${b}`).join('\n');
    }

    // ===== 키워드 =====
    function renderKWPreview(){
      const ul = $('#kwPreview'); if(!ul) return; ul.innerHTML='';
      KW.forEach((k)=>{
        const li=document.createElement('li');
        li.innerHTML = `<strong>${k.name}</strong> — ${k.qs.join(' / ')}`;
        ul.appendChild(li);
      });
    }
    function pickKW(n=2){
      const picks = shuffleArray(KW).slice(0,n);
      const holder = $('#kwResult'); if(holder){ holder.innerHTML='';
        picks.forEach((k)=>{
          const div=document.createElement('div'); div.className='chip';
          div.textContent = `${k.name}: ${k.qs[0]}`;
          holder.appendChild(div);
        });
      }
      return picks.map(k=>`${k.name}: ${k.qs.join(' / ')}`).join('\n');
    }

    // ===== 조 섞기 (6인×2, 4인×2) =====
    const DEFAULT_NAMES = [
      '유승빈','김상권','권동국','박유정','변서호','손가은','심원섭','이이강','이주은','정용진','최승아','하경덕','오승빈','유진','이명비','이종화','김환희','신재민','최유리'
    ];

    // sizes = [6,6,4,4]
    function groupBySizes(list, sizes=[6,6,4,4]){
      const shuffled = shuffleArray(list.filter(x=>x && x.trim()));
      const teams=[];
      let idx=0;
      for(const sz of sizes){
        const slice = shuffled.slice(idx, idx+sz);
        teams.push(slice);
        idx += sz;
      }
      const leftover = shuffled.slice(idx);
      return {teams, leftover};
    }

    function renderTeams(teams, leftover){
      const root = $('#teams'); if(!root) return; root.innerHTML='';

      teams.forEach((t,idx)=>{
        const targetSize = idx<2 ? 6 : 4; // 앞 2개는 6인, 뒤 2개는 4인
        const box=document.createElement('div'); box.className='card';
        const title=document.createElement('div');
        title.innerHTML = `<strong>${idx+1}조</strong> <span class="muted">(${t.length}/${targetSize}명)</span>`;
        const ul=document.createElement('ul');
        t.forEach(n=>{ const li=document.createElement('li'); li.textContent=n; ul.appendChild(li); });
        box.appendChild(title); box.appendChild(ul); root.appendChild(box);
      });

      if(leftover && leftover.length){
        const box=document.createElement('div'); box.className='card';
        const title=document.createElement('div');
        title.innerHTML = `<strong>예비/스탠바이</strong> <span class="muted">(${leftover.length}명)</span>`;
        const ul=document.createElement('ul');
        leftover.forEach(n=>{ const li=document.createElement('li'); li.textContent=n; ul.appendChild(li); });
        box.appendChild(title); box.appendChild(ul); root.appendChild(box);

        const p=document.createElement('p'); p.className='muted';
        p.textContent='※ 예비 인원은 진행자가 상황에 따라 4인 조에 합류시키거나 별도 테이블로 운영하세요.';
        root.appendChild(p);
      }
    }

    // ===== 팀 이미지로 저장 =====
    function roundRect(ctx, x, y, w, h, r){
      const rr = Math.min(r, w/2, h/2);
      ctx.beginPath();
      ctx.moveTo(x+rr, y);
      ctx.arcTo(x+w, y, x+w, y+h, rr);
      ctx.arcTo(x+w, y+h, x, y+h, rr);
      ctx.arcTo(x, y+h, x, y, rr);
      ctx.arcTo(x, y, x+w, y, rr);
      ctx.closePath();
    }

    function exportTeamsImage(){
      const boxes = Array.from($('#teams').querySelectorAll('.card'));
      if(!boxes.length){ alert('먼저 섞기를 눌러 팀을 만들어요!'); return; }
      const canvas = document.getElementById('exportPreview');
      const ctx = canvas.getContext('2d');
      const W = 1200;
      const P = 40;
      const COL = 2;
      const GAP = 24;
      const cardW = Math.floor((W - P*2 - GAP*(COL-1)) / COL);

      const namesPerBox = boxes.map(b=> b.querySelectorAll('li').length);
      const rows = Math.ceil(boxes.length / COL);
      const cardHByIdx = namesPerBox.map(n=> 80 + n*34 + 16);
      const rowHeights = Array.from({length:rows}).map((_,r)=>{
        const i1 = r*COL, i2 = i1+1;
        return Math.max(cardHByIdx[i1]||120, cardHByIdx[i2]||120);
      });
      const H = P*2 + rowHeights.reduce((a,b)=>a+b,0) + GAP*(rows-1) + 60;
      canvas.width = W; canvas.height = H;

      const grad = ctx.createLinearGradient(0,0,W,H);
      grad.addColorStop(0,'#0b1020');
      grad.addColorStop(1,'#172244');
      ctx.fillStyle = grad; ctx.fillRect(0,0,W,H);

      ctx.fillStyle = '#eaf0ff';
      ctx.font = 'bold 28px "Pretendard", "Malgun Gothic", system-ui';
      ctx.fillText('생각의 바다 — 조 편성 (6×2, 4×2)', P, 46);
      ctx.font = '14px "Pretendard", "Malgun Gothic", system-ui';
      const now = new Date();
      ctx.fillText(now.toLocaleString(), W-P-260, 46);

      let y = P+40;
      boxes.forEach((box,i)=>{
        const col = i % COL; const row = Math.floor(i / COL);
        const x = P + col*(cardW+GAP);
        if(col===0 && i>0){ y += (rowHeights[row-1]||120) + GAP; }
        const names = Array.from(box.querySelectorAll('li')).map(li=>li.textContent);
        const strong = box.querySelector('strong')?.textContent || `${i+1}조`;
        const muted = box.querySelector('.muted')?.textContent || '';
        const cardH = cardHByIdx[i];

        ctx.globalAlpha = 1;
        ctx.fillStyle = 'rgba(255,255,255,0.06)';
        roundRect(ctx,x,y,cardW,cardH,14); ctx.fill();
        ctx.strokeStyle = 'rgba(255,255,255,0.12)'; ctx.stroke();

        ctx.fillStyle = '#cfe1ff';
        ctx.font = '600 18px "Pretendard", "Malgun Gothic", system-ui';
        ctx.fillText(`${strong} ${muted}`, x+18, y+32);

        ctx.fillStyle = '#eaf0ff';
        ctx.font = '16px "Pretendard", "Malgun Gothic", system-ui';
        names.forEach((n,idx2)=>{
          ctx.fillText(`• ${n}`, x+22, y+64 + idx2*28);
        });
      });

      const url = canvas.toDataURL('image/png');
      const a = document.createElement('a');
      a.href = url; a.download = '생각의바다_조편성_6x2_4x2.png';
      document.body.appendChild(a); a.click(); a.remove();
    }

    // ===== 초기화 =====
    function init(){
      const namesBox = $('#names'); if(namesBox) namesBox.value = DEFAULT_NAMES.join('\n');
      renderBGPreview();
      renderKWPreview();

      $('#pickBG')?.addEventListener('click', ()=> pickBG(1));
      $('#pickBG3')?.addEventListener('click', ()=> pickBG(3));
      $('#copyBG')?.addEventListener('click', ()=> copyText($('#bgResult').textContent));

      $('#pickKW2')?.addEventListener('click', ()=> pickKW(2));
      $('#pickKW1')?.addEventListener('click', ()=> pickKW(1));
      $('#copyKW')?.addEventListener('click', ()=> copyText($('#kwResult').textContent));

      $('#shuffle')?.addEventListener('click', ()=>{
        const names = $('#names').value.split(/\n|,|;/).map(x=>x.trim()).filter(Boolean);
        const {teams, leftover} = groupBySizes(names, [6,6,4,4]);
        renderTeams(teams, leftover);
      });

      $('#copyTeams')?.addEventListener('click', ()=>{
        const boxes = Array.from($('#teams').querySelectorAll('.card'));
        if(!boxes.length){ alert('먼저 섞기를 눌러 팀을 만들어요!'); return; }
        const lines = boxes.map((box,i)=>{
          const title = box.querySelector('strong')?.textContent || `${i+1}조`;
          const who = Array.from(box.querySelectorAll('li')).map(li=>li.textContent).join(', ');
          const cnt = box.querySelector('.muted')?.textContent.replace(/[()명]/g,'') || '';
          return `${title}${cnt?` (${cnt}명)`:''}: ${who}`;
        }).join('\n');
        copyText(lines);
      });

      $('#saveImage')?.addEventListener('click', exportTeamsImage);
    }

    if(document.readyState === 'loading'){
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>
